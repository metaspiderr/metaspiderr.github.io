<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>MetaSpider Bookmarks</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>

    <h1> <a href="service.html">MetaSpider ToolBox</a> </h1>

    <form id="bookmarkForm">
        <label for="newBookmarkInput">Введите URL:</label>
        <input type="text" id="newBookmarkInput" name="newBookmark" size="50">
        <button type="button" onclick="addBookmark()">Добавить</button>
    </form>

    <h2>Сохраненные закладки:</h2>
    <ul id="bookmarkList">
    </ul>

    <script type="text/javascript">
        // Функция для добавления закладки
        function addBookmark() {
            var url = document.getElementById("newBookmarkInput").value;

            if (url) {
                // Автоматически добавляем "http://" если отсутствует
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "http://" + url;
                }

                var bookmarks = localStorage.getItem("bookmarks");
                if (bookmarks === null) {
                    bookmarks = [];
                } else {
                    bookmarks = JSON.parse(bookmarks);
                }

                // Проверяем, нет ли уже такой закладки
                if (!bookmarks.includes(url)) {
                    bookmarks.push(url);
                    localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
                    displayBookmarks();
                } else {
                    alert("Эта закладка уже существует.");
                }

                document.getElementById("newBookmarkInput").value = "";
            } else {
                alert("Пожалуйста, введите URL.");
            }
        }

        // Функция для удаления закладки
        function deleteBookmark(index) {
            var bookmarks = localStorage.getItem("bookmarks");
            if (bookmarks !== null) {
                bookmarks = JSON.parse(bookmarks);
                bookmarks.splice(index, 1); // Удаляем элемент по индексу
                localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
                displayBookmarks(); // Обновляем список
            }
        }

        // Функция для отображения закладок
        function displayBookmarks() {
            var bookmarkList = document.getElementById("bookmarkList");
            bookmarkList.innerHTML = "";

            var bookmarks = localStorage.getItem("bookmarks");
            if (bookmarks !== null) {
                bookmarks = JSON.parse(bookmarks);
                for (var i = 0; i < bookmarks.length; i++) {
                    var url = bookmarks[i];
                    var listItem = document.createElement("li");

                    var link = document.createElement("a");
                    link.href = url;
                    link.target = "_blank";
                    link.appendChild(document.createTextNode(url));
                    listItem.appendChild(link);

                    // Кнопка "Удалить"
                    var deleteButton = document.createElement("button");
                    deleteButton.type = "button";
                    deleteButton.appendChild(document.createTextNode("[удалить]"));
                    deleteButton.onclick = (function(idx) {
                        return function() {
                            deleteBookmark(idx);
                        };
                    })(i);
                    listItem.appendChild(deleteButton);

                    // Добавляем <br> после ссылки и кнопки
                    var brElement = document.createElement("br");
                    listItem.appendChild(brElement);

                    bookmarkList.appendChild(listItem);
                }
            }
        }

        // Загружаем закладки при загрузке страницы
        window.onload = function() {
            // Сначала отображаем существующие закладки
            displayBookmarks();

            // Проверяем наличие параметра 'newBookmark' в URL
            var params = new URLSearchParams(window.location.search);
            if (params.has('newBookmark')) {
                var urlFromParam = params.get('newBookmark');

                if (urlFromParam) {
                    // Применяем ту же логику добавления "http://"
                    if (!urlFromParam.startsWith("http://") && !urlFromParam.startsWith("https://")) {
                        urlFromParam = "http://" + urlFromParam;
                    }

                    var bookmarks = localStorage.getItem("bookmarks");
                    if (bookmarks === null) {
                        bookmarks = [];
                    } else {
                        bookmarks = JSON.parse(bookmarks);
                    }

                    // Добавляем новую закладку из URL-параметра, если ее еще нет
                    if (!bookmarks.includes(urlFromParam)) {
                        bookmarks.push(urlFromParam);
                        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
                        // Обновляем список, чтобы показать новую закладку
                        displayBookmarks();
                    }
                    // Очищаем параметр из URL, чтобы при обновлении страницы он не добавлялся снова
                    // window.history.replaceState({}, document.title, window.location.pathname);
                    // ^ Закомментировано, если нужно, чтобы закладка добавлялась каждый раз при переходе по ссылке с параметром
                }
            }
        };
    </script>

</body>
</html>
